function dos_fechas(fecha1,fecha2){f1=fecha1.getTime();f2=fecha2.getTime();var difference_ms=f1-f2;difference_ms=difference_ms/1e3;var seconds=Math.floor(difference_ms%60);difference_ms=difference_ms/60;var minutes=Math.floor(difference_ms%60);difference_ms=difference_ms/60;var hours=Math.floor(difference_ms%24);var days=Math.floor(difference_ms/24);return days+" d, "+hours+" h, "+minutes+" min, "+seconds+" s"}function img_reportes(){var inicial="2019-08";var a_inicial=inicial.split("-")[0];var m_inicial=inicial.split("-")[1];var f_final=new Date;if(f_final.getMonth()==0){var a_final=f_final.getFullYear()-1;var m_final="12"}else{var a_final=f_final.getFullYear();var m_final=""+f_final.getMonth()}if(m_final.length<2)m_final="0"+m_final;f_final=a_final+"-"+m_final;console.log(inicial);var i=0;while((new Intl.Collator).compare(inicial,f_final)!=0){console.log((new Intl.Collator).compare(inicial,f_final));m_inicial=parseInt(m_inicial)+1;if(m_inicial>12){a_inicial=parseInt(a_inicial)+1;m_inicial=1;inicial=a_inicial.toString()+"-0"+m_inicial.toString()}else{if(m_inicial.toString().length<2){inicial=a_inicial.toString()+"-0"+m_inicial.toString()}else{inicial=a_inicial.toString()+"-"+m_inicial.toString()}}console.log(inicial);var bloque='<div class="column is-12-mobile is-6-tablet is-4-desktop is-3-widescreen">';bloque+='<div class="card">';bloque+='<div class="card-image reporte_img">';bloque+='<figure class="image has-ratio">';bloque+='<img src="img/reportes_mensuales/'+inicial+'-img.png" alt="Placeholder image">';bloque+="</figure>";bloque+="</div>";bloque+='<div class="content has-text-centered">';bloque+='<p class="subtitle is-5">Reporte Incendios</br>'+inicial+"</p>";bloque+="</div>";bloque+="</div>";bloque+="</div>";$("#reportes").append(bloque)}}var map;var mapa_incendios;var mapa_poblados;var puntos=[];var daaatos;var incendio_detallado;var pueblo_detallado;var detalles;var icono=L.Icon.extend({"options":{"shadowUrl":"static/img/sombra.png","shadowRetinaUrl":"static/img/sombra.png","iconSize":[25,33],"shadowSize":[25,25],"iconAncor":[0,0],"shadowAnchor":[2,7],"popupAnchor":[0,-10]}});var iconos={"incendio":new icono({"iconUrl":"static/img/incendios.png","iconRetinaUrl":"static/img/incendios.png"}),"poblado":new icono({"iconUrl":"static/img/poblados.png","iconRetinaUrl":"static/img/poblados.png"})};function centro_coords(lat1,lng1,lat2,lng2){lat1=lat1*Math.PI/180;lat2=lat2*Math.PI/180;lng1=lng1*Math.PI/180;lng2=lng2*Math.PI/180;var x=[];var y=[];var z=[];x.push(Math.cos(lat1)*Math.cos(lng1));y.push(Math.cos(lat1)*Math.sin(lng1));z.push(Math.sin(lat1));x.push(Math.cos(lat2)*Math.cos(lng2));y.push(Math.cos(lat2)*Math.sin(lng2));z.push(Math.sin(lat2));var ax,ay,az;ax=(x[0]+x[1])/2;ay=(y[0]+y[1])/2;az=(z[0]+z[1])/2;var rlat,rlng,rhyp;rlng=Math.atan2(ay,ax);rhyp=Math.sqrt(ax*ax+ay*ay);rlat=Math.atan2(az,rhyp);rlat=rlat*180/Math.PI;rlng=rlng*180/Math.PI;var respuesta={"lat":rlat,"lng":rlng};return respuesta}$(document).ready(function(){var tiempo_de_descarga=15;$(".navbar-burger").click(function(){$(".navbar-burger").toggleClass("is-active");$(".navbar-menu").toggleClass("is-active")});$(".modal-close").click(function(){$(".modal").toggleClass("is-active");$("html").toggleClass("is-clipped")});$(".buttons > a").click(function(){$(".navbar-burger").toggleClass("is-active");$(".navbar-menu").toggleClass("is-active")});if($("#map").length){var guatemala=L.tileLayer("https://raw.githubusercontent.com/SparkProjects/guatemala-tiles/master/tiles/{z}/{x}/{y}.png",{"errorTileUrl":"https://raw.githubusercontent.com/SparkProjects/guatemala-tiles/master/tiles/fallbacktile.png"});map=L.map("map",{"layers":[guatemala],"zoomControl":false,"attribution":'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',"detectRetina":true,"maxZoom":14,"minZoom":7}).setView([15.250372632398173,-90.0439453125],7);PruneCluster.Cluster.ENABLE_MARKERS_LIST=true;mapa_incendios=new PruneClusterForLeaflet;Papa.parse("datosf_sim_web.csv",{"header":true,"download":true,"skipEmptyLines":false,"step":function(row){var f_a=new Date;if(row.data["tipo_suelo"]!==undefined){if((row.data["tipo_suelo"].trim()==="Arboles dispersos"||row.data["tipo_suelo"].trim()==="Bosque"||row.data["tipo_suelo"].trim()==="Cuerpos de agua"||row.data["tipo_suelo"].trim()==="Espacios abiertos, poca vegetacion"||row.data["tipo_suelo"].trim()==="Pastizales"||row.data["tipo_suelo"].trim()==="Sabanas"||row.data["tipo_suelo"].trim()==="Sin informacion"||row.data["tipo_suelo"].trim()==="Urbano"||row.data["tipo_suelo"].trim()==="Vegetaci\xf3n arbistiva baja (guamil-matorral)"||row.data["tipo_suelo"].trim()==="Zonas humedas")&&row.data["visible"]==1&&row.data["volcan"]==0){var marker=new PruneCluster.Marker(parseFloat(row.data["latitude"].substr(0,8)),parseFloat(row.data["longitude"].substr(0,9)));marker.data.icon=L.icon({"iconUrl":"static/img/incendios.png","iconRetinaUrl":"static/img/incendios.png","shadowUrl":"static/img/sombra.png","shadowRetinaUrl":"static/img/sombra.png","iconSize":[25,33],"shadowSize":[25,25],"iconAncor":[0,0],"shadowAnchor":[2,7],"popupAnchor":[0,-10]});var f_d=new Date(row.data["fecha_utc"]);var diif_f=dos_fechas(f_a,f_d);marker.data.popup="<center><b>INCENDIO DETECTADO</b></center> <br>"+"<b>Latitud , Longitud</b> <br>"+row.data["latitude"].substr(0,8)+" , "+row.data["longitude"].substr(0,9)+"<br>"+"<b>Departamento</b> <br>"+row.data["departamento"]+"<br>"+"<b>Municipio</b> <br>"+row.data["municipio"]+"<br>"+"<b>Fecha de detecci\xf3n</b> <br>"+f_d.toLocaleString()+"<br>"+"<b>Tiempo activo</b> <br>"+diif_f+"<br>"+"<b>Tipo de suelo</b> <br>"+row.data["tipo_suelo"];marker.data.ID=row.data["id"];marker.data.icono="incendio";puntos.push(marker);mapa_incendios.RegisterMarker(marker);var marker2=new PruneCluster.Marker(parseFloat(row.data["lugarp_latitud"]),parseFloat(row.data["lugarp_longitud"]));marker2.data.icon=L.icon({"iconUrl":"static/img/poblados.png","iconRetinaUrl":"static/img/poblados.png","shadowUrl":"static/img/sombra.png","shadowRetinaUrl":"static/img/sombra.png","iconSize":[25,33],"shadowSize":[25,25],"iconAncor":[0,0],"shadowAnchor":[2,7],"popupAnchor":[0,-10]});marker2.data.popup="<center><b>LUGAR POBLADO</b></center> <br>"+"<b>Latitud , Longitud</b> <br>"+row.data["lugarp_latitud"].substr(0,8)+" , "+row.data["lugarp_longitud"].substr(0,9)+"<br>"+"<b>Departamento</b> <br>"+row.data["lugarp_departamento"]+"<br>"+"<b>Municipio</b> <br>"+row.data["lugarp_municipio"]+"<br>"+"<b>Sitio</b> <br>"+row.data["lugarp_categoria"]+" "+row.data["lugarp_lugar"];marker2.data.ID=row.data["id"];marker2.data.icono="poblado";mapa_incendios.RegisterMarker(marker2);var texto='<article class="media box is-shadowless alineado-v" data-departamento = '+row.data["departamento"].trim()+">"+'<figure class="media-left has-text-centered alineado-t">'+'<p class="block">Suelo afectado</p>'+'<span class="icon-text"><span class="iconis-large">'+'<i class="fa-solid fa-fire fa-3x "></i>'+'</span></span><p class="block">'+row.data["tipo_suelo"].trim()+'</p></figure><div class="media-content">'+'<div class="content"><div class="icon-text">'+'<span class="icon has-text-info"><i class="fa-solid fa-location-dot"></i></span>'+"<span>Latitud: "+row.data["latitude"].substr(0,8)+" Longitud: "+row.data["longitude"].substr(0,9)+"</span>"+'</div><div class="icon-text"><span class="icon has-text-info">'+'<i class="fa-solid fa-earth-americas"></i></span>'+"<span>"+row.data["municipio"].trim()+", "+row.data["departamento"].trim()+"</span>"+'</div><div class="icon-text"><span class="icon has-text-info">'+'<i class="fa-solid fa-calendar-days"></i></span>'+"<span>Detectado: "+f_d.toLocaleString()+"</span>"+'</div><div class="icon-text"><span class="icon has-text-info">'+'<i class="fa-solid fa-house-circle-exclamation"></i></span>'+"<span>Poblado cercano: "+row.data["lugarp_categoria"]+" "+row.data["lugarp_lugar"]+", "+row.data["lugarp_municipio"].trim()+", "+row.data["lugarp_departamento"]+"</span>"+'</div></div></div><div class="media-right">'+'<button class="button is-info zoomevento" data-id = '+row.data["id"]+">Ver</button>"+"</div></article>";$("#datos-incendios").prepend(texto)}}},"complete":function(){map.addLayer(mapa_incendios)}});L.control.scale().addTo(map)}setTimeout(function intro(){$("#load-in").removeClass("is-active")},2e3);$("body").on("click",".zoomevento",function(){var puntos=mapa_incendios.GetMarkers().filter(marcador=>marcador.data.ID==$(this).attr("data-id"));var centro=centro_coords(puntos[0].position.lat,puntos[0].position.lng,puntos[1].position.lat,puntos[1].position.lng);map.setView(centro,14,Animation=true);if(map.hasLayer(mapa_incendios)){map.removeLayer(mapa_incendios)}if(map.hasLayer(detalles)){detalles.clearLayers()}incendio_detallado=L.marker([puntos[0].position.lat,puntos[0].position.lng],{"icon":iconos[puntos[0].data.icono]});pueblo_detallado=L.marker([puntos[1].position.lat,puntos[1].position.lng],{"icon":iconos[puntos[1].data.icono]});detalles=L.featureGroup([incendio_detallado,pueblo_detallado]).addTo(map);map.fitBounds(detalles.getBounds())});$(".reporte_img").click(function(){var img=$(this).find(".image img");var img_type=img.attr("src");console.log(img);console.log(img_type);$("#vista-previa").attr("src",img_type);$(".modal").toggleClass("is-active");$("html").toggleClass("is-clipped")});$("#departamento").change(function(){$("#datos-incendios").animate({"scrollTop":"0"},200,function(){});var seleccionado=this.value;$("#datos-incendios").children("article.media").each(function(){if($(this).hasClass("is-hidden")){$(this).removeClass("is-hidden")}if(seleccionado==""){}else if($(this).attr("data-departamento")==seleccionado){}else{$(this).addClass("is-hidden")}})});$("#reiniciar_lista").click(function(){$("#datos-incendios").animate({"scrollTop":"0"},200,function(){});$("#departamento").val("");$("#datos-incendios").children("article.media").each(function(){if($(this).hasClass("is-hidden")){$(this).removeClass("is-hidden")}})});$("#mostrar_todo").click(function(){if(map.hasLayer(detalles)){detalles.clearLayers();map.removeLayer(detalles)}if(map.hasLayer(mapa_incendios)){map.setView([15.250372632398173,-90.0439453125],7)}else{map.addLayer(mapa_incendios);map.setView([15.250372632398173,-90.0439453125],7)}})});